<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ôõ Chess Arena</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="three.min.js"></script>
    <script src="hero-3d.js"></script>
</head>
<body>

    <!-- ===== SHARED 3D BACKGROUND ===== -->
    <canvas id="hero-canvas"></canvas>

    <!-- ===== MODE SELECTION SCREEN ===== -->
    <div id="mode-select-screen" class="screen active">
        <div class="ms-wrapper">
            <!-- Header -->
            <div class="ms-hero">
                <div class="ms-hero-icon">‚ôî</div>
                <h1 class="ms-title">Ma√Ætre du Jeu</h1>
                <p class="ms-subtitle">La strat√©gie pure, red√©finie.</p>
            </div>

            <!-- Cards -->
            <div class="ms-cards">
                <button id="btn-mode-basic" class="ms-card ms-card-light">
                    <div class="ms-card-content">
                        <span class="ms-card-icon">‚ö°Ô∏è</span>
                        <div class="ms-card-text">
                            <span class="ms-card-head">Multijoueur</span>
                            <span class="ms-card-sub">D√©fiez le monde</span>
                        </div>
                    </div>
                    <div class="ms-card-arrow">‚Üí</div>
                </button>

                <button id="btn-mode-salon" class="ms-card ms-card-accent">
                    <div class="ms-card-content">
                        <span class="ms-card-icon">üß†</span>
                        <div class="ms-card-text">
                            <span class="ms-card-head">Solo vs IA</span>
                            <span class="ms-card-sub">Affrontez l'ordinateur</span>
                        </div>
                    </div>
                    <div class="ms-card-arrow">‚Üí</div>
                </button>
            </div>

            <p class="ms-footer">Classement mondial ¬∑ Cr√©ez votre compte</p>
        </div>
    </div>

    <!-- ===== AUTH SCREEN (Multiplayer) ===== -->
    <div id="auth-screen" class="screen">
        <div class="ms-wrapper auth-wrapper">
            <div class="ms-hero auth-hero">
                <div class="ms-hero-icon">‚öî</div>
                <h1 class="ms-title">Chess <span class="welcome-gradient">Arena</span></h1>
                <p class="ms-subtitle">Cr√©ez un compte ou connectez-vous</p>
            </div>

            <!-- Tab selector -->
            <div class="auth-tabs">
                <button class="auth-tab active" id="tab-login">Connexion</button>
                <button class="auth-tab" id="tab-register">Inscription</button>
            </div>

            <!-- Login form -->
            <form id="login-form" class="auth-form">
                <div class="auth-field">
                    <label class="auth-label">Pseudo</label>
                    <input type="text" id="login-username" class="auth-input"
                        placeholder="Votre pseudo" autocomplete="username" maxlength="20" />
                </div>
                <div class="auth-field">
                    <label class="auth-label">Mot de passe</label>
                    <input type="password" id="login-password" class="auth-input"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
                </div>
                <p id="login-error" class="auth-error hidden"></p>
                <button type="submit" class="btn-auth-submit">Se connecter ‚Üí</button>
            </form>

            <!-- Register form -->
            <form id="register-form" class="auth-form hidden">
                <div class="auth-field">
                    <label class="auth-label">Pseudo</label>
                    <input type="text" id="register-username" class="auth-input"
                        placeholder="2-20 caract√®res" autocomplete="username" maxlength="20" />
                </div>
                <div class="auth-field">
                    <label class="auth-label">Mot de passe</label>
                    <input type="password" id="register-password" class="auth-input"
                        placeholder="4 caract√®res minimum" autocomplete="new-password" />
                </div>
                <p id="register-error" class="auth-error hidden"></p>
                <button type="submit" class="btn-auth-submit">Cr√©er le compte ‚ú¶</button>
            </form>

            <button id="btn-auth-back" class="btn-back-auth">‚Üê Retour</button>
        </div>
    </div>

    <!-- ===== WELCOME SCREEN ===== -->
    <div id="welcome-screen" class="screen">
        <div class="ms-wrapper welcome-wrapper">
            <div class="ms-hero">
                <div class="ms-hero-icon welcome-icon-anim">‚ôî</div>
                <h1 class="ms-title">Pr√™t √†<br><span class="welcome-gradient">jouer ?</span></h1>
                <p class="ms-subtitle">Entrez dans la l√©gende.</p>
            </div>
            <button id="btn-enter" class="btn-play-pulse">
                <span class="btn-shimmer"></span>
                JOUER
            </button>
            <p class="ms-footer">Aucun compte requis ¬∑ Jeu imm√©diat</p>
            <img src="epitech_logo.png" alt="Epitech" class="epitech-logo" />
        </div>
    </div>

    <!-- ===== LOBBY ===== -->
    <div id="lobby" class="screen">
        <div class="lobby-box">

            <!-- Header -->
            <div class="lobby-header">
                <div class="lobby-icon">‚ôî</div>
                <h1>Chess<span>Arena</span></h1>
                <p class="tagline" id="welcome-tagline">Pr√™t √† en d√©coudre ?</p>
            </div>

            <!-- Player stats bar (online mode only) -->
            <div id="player-stats-bar" class="player-stats-bar hidden">
                <div class="stats-left">
                    <span class="stats-username" id="stats-username">Joueur</span>
                    <div class="stats-record">
                        <span class="stat-win" id="stats-wins">0</span><span class="stat-label">V</span>
                        <span class="stat-sep">¬∑</span>
                        <span class="stat-draw" id="stats-draws">0</span><span class="stat-label">N</span>
                        <span class="stat-sep">¬∑</span>
                        <span class="stat-loss" id="stats-losses">0</span><span class="stat-label">D</span>
                    </div>
                </div>
                <div class="stats-right">
                    <button id="btn-ranking" class="btn-stats-action" title="Classement">üèÜ</button>
                    <button id="btn-logout" class="btn-stats-action btn-logout-icon" title="D√©connexion">‚á•</button>
                </div>
            </div>

            <!-- Card -->
            <div class="lobby-card" id="lobby-content">

                <!-- Mode selector -->
                <div class="mode-switch">
                    <button class="mode-btn active" data-mode="online">
                        <span class="mode-icon">üåê</span>
                        <span class="mode-text">En ligne</span>
                    </button>
                    <button class="mode-btn" data-mode="ai">
                        <span class="mode-icon">ü§ñ</span>
                        <span class="mode-text">Contre l'IA</span>
                    </button>
                    <button class="mode-btn" data-mode="self">
                        <span class="mode-icon">‚ôüÔ∏è</span>
                        <span class="mode-text">2 joueurs local</span>
                    </button>
                    <div class="mode-slider"></div>
                </div>

                <!-- Time control -->
                <div class="field">
                    <label class="field-label">‚è± Cadence</label>
                    <div class="time-grid">
                        <button class="time-btn" data-time="0">‚àû</button>
                        <button class="time-btn" data-time="60">1 min</button>
                        <button class="time-btn" data-time="180">3 min</button>
                        <button class="time-btn active" data-time="300">5 min</button>
                        <button class="time-btn" data-time="600">10 min</button>
                        <button class="time-btn" data-time="900">15 min</button>
                        <button class="time-btn" data-time="1800">30 min</button>
                    </div>
                </div>

                <!-- Separator -->
                <hr class="sep">

                <!-- Online actions -->
                <div id="online-actions" class="actions-panel">
                    <button id="btn-matchmaking" class="btn-play btn-matchmaking">
                        <span class="btn-play-icon">‚öî</span>
                        Trouver un adversaire
                    </button>

                    <div class="or-divider"><span>ou partie priv√©e</span></div>

                    <div class="private-row">
                        <button id="btn-create" class="btn-secondary">
                            <span class="btn-sec-icon">‚ôú</span>
                            Cr√©er un salon
                        </button>

                        <div class="join-row">
                            <input type="text" id="input-room" placeholder="CODE" maxlength="5" autocomplete="off" spellcheck="false">
                            <button id="btn-join" class="btn-join-go">Rejoindre</button>
                        </div>
                    </div>
                </div>

                <!-- AI actions -->
                <div id="ai-actions" class="actions-panel hidden">
                    <div class="field">
                        <label class="field-label">Niveau de l'IA</label>
                        <div class="segmented-control">
                            <button class="diff-btn diff" data-diff="1">Novice</button>
                            <button class="diff-btn diff active" data-diff="2">Inter.</button>
                            <button class="diff-btn diff" data-diff="3">Expert</button>
                            <button class="diff-btn diff" data-diff="4">Ma√Ætre</button>
                            <button class="diff-btn diff diff-gm" data-diff="5">Grand Ma√Ætre</button>
                        </div>
                    </div>

                    <div class="field">
                        <label class="field-label">‚ôî Votre couleur</label>
                        <div class="color-grid">
                            <button class="color-btn color-pick active" data-color="white">
                                <span class="color-preview white"></span>Blancs
                            </button>
                            <button class="color-btn color-pick" data-color="black">
                                <span class="color-preview black"></span>Noirs
                            </button>
                            <button class="color-btn color-pick" data-color="random">
                                üé≤ Al√©atoire
                            </button>
                        </div>
                    </div>

                    <button id="btn-play-ai" class="btn-play">
                        <span class="btn-play-icon">‚ôû</span>
                        Lancer la partie
                    </button>
                </div>

                <!-- Local self-play actions -->
                <div id="self-actions" class="actions-panel hidden">
                    <p class="field-label">M√™me appareil, les deux couleurs</p>
                    <button id="btn-play-self" class="btn-play">
                        <span class="btn-play-icon">‚ôî‚ôö</span>
                        Jouer contre soi-m√™me
                    </button>
                </div>

            </div>

            <!-- Status toast -->
            <div id="lobby-status" class="toast hidden"></div>

            <!-- Waiting overlay (room code) -->
            <div id="waiting-panel" class="hidden">
                <div class="waiting-card">
                    <span class="waiting-label">Code du salon</span>
                    <div id="display-room-code" class="waiting-code">-----</div>
                    <button id="btn-copy-code" class="btn-copy">üìã Copier le code</button>
                </div>
                <div class="waiting-anim">
                    <div class="spinner"></div>
                    <p>En attente d'un adversaire‚Ä¶</p>
                </div>
                <button id="btn-cancel" class="btn-cancel">‚úï Annuler</button>
            </div>

            <!-- Matchmaking waiting overlay -->
            <div id="matchmaking-panel" class="hidden">
                <div class="matchmaking-visual">
                    <div class="mm-pieces">
                        <span class="mm-piece mm-piece-left">‚ôî</span>
                        <div class="mm-vs">
                            <div class="mm-spinner"></div>
                            <span>VS</span>
                        </div>
                        <span class="mm-piece mm-piece-right">‚ôö</span>
                    </div>
                </div>
                <div class="mm-info">
                    <p class="mm-status">Recherche d'un adversaire‚Ä¶</p>
                    <p class="mm-detail" id="mm-detail">Cadence : <span id="mm-time-display">5 min</span></p>
                    <div class="mm-timer-row">
                        <span class="mm-elapsed" id="mm-elapsed">0:00</span>
                    </div>
                </div>
                <button id="btn-cancel-mm" class="btn-cancel">‚úï Annuler la recherche</button>
            </div>

        </div>
        <!-- Ranking overlay -->
        <div id="ranking-overlay" class="overlay hidden">
            <div class="dialog ranking-dialog">
                <button id="btn-close-ranking" class="btn-close-ranking">‚úï</button>
                <h2 class="ranking-title">üèÜ Classement</h2>
                <div id="ranking-list" class="ranking-list">
                    <p class="ranking-loading">Chargement‚Ä¶</p>
                </div>
            </div>
        </div>

    </div>

    <!-- ===== GAME ===== -->
    <div id="game" class="screen">
        <div class="game-col">

            <!-- Opponent -->
            <div class="player-row">
                <div class="indicator" id="opponent-indicator"></div>
                <span class="player-name" id="opponent-label">Adversaire</span>
                <div class="captured-row" id="opponent-captured-list"></div>
                <span class="advantage" id="opponent-advantage"></span>
                <span class="timer" id="opponent-timer"></span>
            </div>

            <!-- Board -->
            <div class="board-wrap">
                <div class="labels-col" id="labels-left"></div>
                <div>
                    <div class="labels-row" id="labels-top"></div>
                    <div class="board" id="board"></div>
                    <div class="labels-row" id="labels-bottom"></div>
                </div>
                <div class="labels-col" id="labels-right"></div>
            </div>

            <!-- Self -->
            <div class="player-row">
                <div class="indicator" id="self-indicator"></div>
                <span class="player-name" id="self-label">Vous</span>
                <div class="captured-row" id="self-captured-list"></div>
                <span class="advantage" id="self-advantage"></span>
                <span class="timer" id="self-timer"></span>
            </div>

            <!-- Connection status banner -->
            <div id="connection-banner" class="connection-banner hidden">
                <span id="connection-banner-text">Reconnexion‚Ä¶</span>
            </div>

            <!-- Status + actions -->
            <div class="status-row">
                <button id="btn-back-menu" class="btn-sm hidden">‚Ü© Menu</button>
                <div class="status-text" id="game-status">En attente‚Ä¶</div>
                <button id="btn-resign" class="btn-sm btn-red">üè≥ Abandon</button>
            </div>

        </div>

        <!-- Move history side panel (desktop) -->
        <div class="history-panel" id="move-history">
            <div class="history-title">Historique</div>
            <div class="moves-list" id="moves-list"></div>
        </div>

        <!-- Promotion -->
        <div id="promotion-dialog" class="overlay hidden">
            <div class="dialog">
                <h3>Promotion</h3>
                <div class="promo-row" id="promotion-choices"></div>
            </div>
        </div>

        <!-- Game over -->
        <div id="game-over" class="overlay hidden">
            <div class="dialog">
                <div class="go-icon" id="game-over-icon">üèÜ</div>
                <h2 id="game-over-title">Partie termin√©e</h2>
                <p id="game-over-message"></p>
                <button id="btn-new-game" class="btn-main">Nouvelle partie</button>
            </div>
        </div>
    </div>

    <script src="chess.js"></script>
    <script src="ai.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
